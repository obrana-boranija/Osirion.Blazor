@namespace Osirion.Blazor.Cms.Admin.Features.Authentication.Components
@inherits BaseComponent
@using Osirion.Blazor.Cms.Admin.Features.Authentication.ViewModels
@using Osirion.Blazor.Cms.Admin.Shared.Components
@inject LoginViewModel ViewModel
@inject NavigationManager NavigationManager

<div class="login @CssClass">
    <div class="login-container">
        <div class="login-header">
            <h1 class="login-title">@Title</h1>
            @if (!string.IsNullOrEmpty(Description))
            {
                    <p class="login-description">@Description</p>
            }
        </div>

        @if (!string.IsNullOrEmpty(ViewModel.ErrorMessage))
        {
                <div class="login-alert login-alert-error">
                    <span class="login-alert-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10" />
                            <line x1="12" y1="8" x2="12" y2="12" />
                            <line x1="12" y1="16" x2="12.01" y2="16" />
                        </svg>
                    </span>
                    <span>@ViewModel.ErrorMessage</span>
                    <button type="button" 
                    class="login-alert-close" 
                    @onclick="() => ViewModel.ErrorMessage = null"
                    aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
        }

        @if (ViewModel.IsShowingTokenInput)
        {
                <div class="login-form">
                    <div class="login-form-group">
                        <label class="login-label" for="accessToken">GitHub Access Token</label>
                        <input type="password" 
                        class="login-input" 
                        id="accessToken"
                        @bind="ViewModel.AccessToken"
                        placeholder="Enter your personal access token" />
                        <small class="login-form-help">
                            Access token should have repo scope permissions.
                        </small>
                    </div>

                    <div class="login-form-actions">
                        <button type="button"
                        class="login-button login-button-outline"
                        @onclick="() => ViewModel.ToggleTokenInput()">
                            Cancel
                        </button>

                        <button type="button"
                        class="login-button login-button-primary"
                        @onclick="LoginWithToken"
                        disabled="@(string.IsNullOrEmpty(ViewModel.AccessToken) || ViewModel.IsLoggingIn)">
                        @if (ViewModel.IsLoggingIn)
                        {
                                    <span class="login-loading-spinner"></span>
                                    <span>Authenticating...</span>
                        }
                        else
                        {
                                    <span>Login with Token</span>
                        }
                        </button>
                    </div>
                </div>
        }
        else
        {
                <div class="login-options">
                @if (EnableGitHubAuth)
                {
                            <button type="button"
                            class="login-button login-button-github"
                            @onclick="LoginWithGitHub">
                                <span class="login-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" />
                                    </svg>
                                </span>
                                Login with GitHub
                            </button>
                }

                    <button type="button"
                    class="login-button login-button-secondary"
                    @onclick="() => ViewModel.ToggleTokenInput()">
                        <span class="login-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
                                <path d="M7 11V7a5 5 0 0 1 10 0v4" />
                            </svg>
                        </span>
                        Login with Access Token
                    </button>
                </div>
        }
    </div>
</div>