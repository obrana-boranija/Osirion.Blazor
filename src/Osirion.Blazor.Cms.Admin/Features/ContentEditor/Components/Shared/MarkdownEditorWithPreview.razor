@namespace Osirion.Blazor.Cms.Admin.Features.ContentEditor.Components.Shared
@using Osirion.Blazor.Cms.Admin.Features.ContentEditor.Services
@using Osirion.Blazor.Cms.Admin.Shared.Components
@inherits BaseComponent
@inject IMarkdownEditorService MarkdownService

<div class="markdown-editor-with-preview @CssClass @(ShowPreview ? "split-view" : "editor-only")">
    <div class="markdown-editor-container">
        <div class="markdown-editor-header">
            <span class="markdown-editor-title">@EditorLabel</span>

            @if (ShowToolbar)
            {
                <div class="markdown-editor-toolbar">
                    <button type="button"
                            class="markdown-editor-toolbar-button"
                            title="Bold"
                            @onclick="@(() => InsertMarkdown("**", "**", "bold text"))">
                        <span class="markdown-editor-toolbar-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"></path>
                                <path d="M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"></path>
                            </svg>
                        </span>
                    </button>

                    <button type="button"
                            class="markdown-editor-toolbar-button"
                            title="Italic"
                            @onclick="@(() => InsertMarkdown("*", "*", "italic text"))">
                        <span class="markdown-editor-toolbar-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="19" y1="4" x2="10" y2="4"></line>
                                <line x1="14" y1="20" x2="5" y2="20"></line>
                                <line x1="15" y1="4" x2="9" y2="20"></line>
                            </svg>
                        </span>
                    </button>

                    <button type="button"
                            class="markdown-editor-toolbar-button"
                            title="Heading"
                            @onclick="@(() => InsertMarkdown("## ", "", "Heading"))">
                        <span class="markdown-editor-toolbar-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M6 12h12"></path>
                                <path d="M6 4h12"></path>
                                <path d="M9 20h6"></path>
                            </svg>
                        </span>
                    </button>

                    <button type="button"
                            class="markdown-editor-toolbar-button"
                            title="Link"
                            @onclick="@(() => InsertMarkdown("[", "](url)", "link text"))">
                        <span class="markdown-editor-toolbar-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                                <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                            </svg>
                        </span>
                    </button>

                    <button type="button"
                            class="markdown-editor-toolbar-button"
                            title="Image"
                            @onclick="@(() => InsertMarkdown("![", "](image-url)", "alt text"))">
                        <span class="markdown-editor-toolbar-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                <polyline points="21 15 16 10 5 21"></polyline>
                            </svg>
                        </span>
                    </button>

                    <button type="button"
                            class="markdown-editor-toolbar-button"
                            title="List"
                            @onclick="@(() => InsertMarkdown("- ", "", "List item"))">
                        <span class="markdown-editor-toolbar-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="8" y1="6" x2="21" y2="6"></line>
                                <line x1="8" y1="12" x2="21" y2="12"></line>
                                <line x1="8" y1="18" x2="21" y2="18"></line>
                                <line x1="3" y1="6" x2="3.01" y2="6"></line>
                                <line x1="3" y1="12" x2="3.01" y2="12"></line>
                                <line x1="3" y1="18" x2="3.01" y2="18"></line>
                            </svg>
                        </span>
                    </button>

                    <button type="button"
                            class="markdown-editor-toolbar-button"
                            title="Code"
                            @onclick="@(() => InsertMarkdown("```\n", "\n```", "code"))">
                        <span class="markdown-editor-toolbar-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="16 18 22 12 16 6"></polyline>
                                <polyline points="8 6 2 12 8 18"></polyline>
                            </svg>
                        </span>
                    </button>
                </div>
            }
        </div>

        <textarea class="markdown-editor-textarea"
                  @bind="EditorContent"
                  @bind:event="oninput"
                  @onkeydown="HandleKeyDown"
                  @ref="TextAreaRef"
                  placeholder="Write your markdown content here..."
                  @onfocus="OnEditorFocus"
                  @onblur="OnEditorBlur"></textarea>
    </div>

    @if (ShowPreview)
    {
        <div class="markdown-preview-container">
            <div class="markdown-preview-header">
                <span class="markdown-preview-title">@PreviewLabel</span>
            </div>

            <div class="markdown-preview-content" @ref="PreviewRef">
                @((MarkupString)Preview)
            </div>
        </div>
    }
</div>