@using Microsoft.AspNetCore.Components.Web
@*
    Advanced SEO Metadata Renderer Component
    Supports traditional SEO, GEO (Generative Engine Optimization), and AEO (Answer Engine Optimization)
    
    Handles both single content pages (Content parameter) and collection pages (ContentItems parameter)
*@

<PageTitle>@_metaTitle</PageTitle>

@if (_hasContent)
{
    <!-- ===== Core SEO Meta Tags ===== -->
    @((MarkupString)RenderMetaTag("description", _metaDescription))
    @((MarkupString)RenderMetaTag("keywords", _metaKeywords))
    @if (!string.IsNullOrWhiteSpace(_author))
    {
        @((MarkupString)RenderMetaTag("author", _author))
    }
    @((MarkupString)RenderMetaTag("generator", "Osirion Blazor CMS"))
    
    <!-- Language and Locale -->
    <meta name="language" content="@_languageCode" />
    <meta http-equiv="content-language" content="@_languageCode" />
    
    <!-- ===== Robots and Indexing Directives ===== -->
    <meta name="robots" content="@_robotsDirective" />
    <meta name="googlebot" content="@_robotsDirective" />
    <meta name="bingbot" content="@_robotsDirective" />
    
    <!-- ===== Canonical URL ===== -->
    @if (!string.IsNullOrWhiteSpace(_canonicalUrl))
    {
        <link rel="canonical" href="@_canonicalUrl" />
    }

    <!-- ===== Alternate Language Versions (hreflang) ===== -->
    @if (AlternateLanguageUrls?.Any() == true)
    {
        foreach (var altUrl in AlternateLanguageUrls)
        {
            <link rel="alternate" hreflang="@altUrl.Split('|')[0]" href="@altUrl.Split('|')[1]" />
        }
    }

    <!-- ===== Pagination Links ===== -->
    @if (!string.IsNullOrWhiteSpace(PrevPageUrl))
    {
        <link rel="prev" href="@PrevPageUrl" />
    }
    @if (!string.IsNullOrWhiteSpace(NextPageUrl))
    {
        <link rel="next" href="@NextPageUrl" />
    }

    <!-- ===== Open Graph Meta Tags ===== -->
    @((MarkupString)RenderPropertyTag("og:title", _ogTitle))
    @((MarkupString)RenderPropertyTag("og:description", _ogDescription))
    @((MarkupString)RenderPropertyTag("og:type", _ogType))
    @((MarkupString)RenderPropertyTag("og:url", _currentUrl))
    @((MarkupString)RenderPropertyTag("og:site_name", _siteName))
    @((MarkupString)RenderPropertyTag("og:locale", _locale))
    
    @if (!string.IsNullOrWhiteSpace(_ogImage))
    {
        @((MarkupString)RenderPropertyTag("og:image", _ogImage))
        @((MarkupString)RenderPropertyTag("og:image:secure_url", _ogImage))
        @((MarkupString)RenderPropertyTag("og:image:alt", _ogImageAlt))
        @if (_ogImageWidth.HasValue)
        {
            <meta property="og:image:width" content="@_ogImageWidth.Value" />
        }
        @if (_ogImageHeight.HasValue)
        {
            <meta property="og:image:height" content="@_ogImageHeight.Value" />
        }
    }

    <!-- Article-specific Open Graph Tags -->
    @if (_isArticle)
    {
        @((MarkupString)RenderPropertyTag("article:published_time", _publishDate?.ToString("yyyy-MM-ddTHH:mm:ssZ")))
        @((MarkupString)RenderPropertyTag("article:modified_time", _modifiedDate?.ToString("yyyy-MM-ddTHH:mm:ssZ")))
        @if (!string.IsNullOrWhiteSpace(_author))
        {
            @((MarkupString)RenderPropertyTag("article:author", _author))
        }
        
        @if (_categories?.Any() == true)
        {
            @((MarkupString)RenderPropertyTag("article:section", _categories.FirstOrDefault()))
        }
        
        @if (_tags?.Any() == true)
        {
            foreach (var tag in _tags)
            {
                @((MarkupString)RenderPropertyTag("article:tag", tag))
            }
        }
    }

    <!-- Facebook-specific -->
    @if (!string.IsNullOrWhiteSpace(FacebookAppId))
    {
        <meta property="fb:app_id" content="@FacebookAppId" />
    }

    <!-- ===== Twitter Card Meta Tags ===== -->
    @((MarkupString)RenderMetaTag("twitter:card", _twitterCard))
    @((MarkupString)RenderMetaTag("twitter:title", _twitterTitle))
    @((MarkupString)RenderMetaTag("twitter:description", _twitterDescription))
    @((MarkupString)RenderMetaTag("twitter:image", _twitterImage))
    @((MarkupString)RenderMetaTag("twitter:image:alt", _twitterTitle))
    @((MarkupString)RenderMetaTag("twitter:site", TwitterSite))
    @((MarkupString)RenderMetaTag("twitter:creator", TwitterCreator))

    <!-- ===== Content Metadata ===== -->
    @if (_publishDate.HasValue)
    {
        @((MarkupString)RenderMetaTag("publish_date", _publishDate.Value))
    }
    @if (_modifiedDate.HasValue)
    {
        @((MarkupString)RenderMetaTag("last_modified", _modifiedDate.Value))
    }
    
    @if (_tags?.Any() == true)
    {
        @((MarkupString)RenderMetaTag("keywords", _tags))
    }
    
    @if (_categories?.Any() == true)
    {
        @((MarkupString)RenderMetaTag("article:section", _categories))
    }

    <!-- Reading Time (for user experience and GEO) -->
    @if (_readTimeMinutes.HasValue && _readTimeMinutes.Value > 0)
    {
        <meta name="reading_time" content="@_readTimeMinutes.Value minutes" />
        <meta name="estimated_reading_time" content="@_readTimeMinutes.Value" />
    }

    <!-- ===== GEO (Generative Engine Optimization) Meta Tags ===== -->
    @if (EnableGeoOptimization && !string.IsNullOrWhiteSpace(_entitySummary))
    {
        <!-- Concise entity summary for AI understanding -->
        <meta name="entity-summary" content="@_entitySummary" />
        <meta name="content-type" content="@(SchemaTypes?.FirstOrDefault().ToString() ?? Content?.Metadata?.SeoProperties?.Type ?? "WebPage")" />
        
        <!-- Content classification for better AI categorization -->
        @if (_categories?.Any() == true)
        {
            <meta name="primary-category" content="@_categories.FirstOrDefault()" />
        }
        
        <!-- Expertise indicators -->
        @if (!string.IsNullOrWhiteSpace(_author))
        {
            <meta name="content-author" content="@_author" />
        }
        <meta name="content-expertise-level" content="professional" />
        @if (_publishDate.HasValue)
        {
            <meta name="content-freshness" content="@((DateTime.UtcNow - _publishDate.Value).TotalDays < 30 ? "recent" : "evergreen")" />
        }
    }

    <!-- ===== AEO (Answer Engine Optimization) Meta Tags ===== -->
    @if (EnableAeoOptimization && _answersTo?.Any() == true)
    {
        <!-- Explicit question-answer mapping for AI assistants -->
        @foreach (var question in _answersTo)
        {
            <meta name="answers-to" content="@question" />
            
            @if (_structuredAnswers?.ContainsKey(question) == true)
            {
                <meta name="answer-@question.GetHashCode()" content="@_structuredAnswers[question]" />
            }
        }
        
        <!-- Content structure hints for better answer extraction -->
        <meta name="content-structure" content="question-answer" />
        <meta name="answer-type" content="comprehensive" />
    }

    <!-- ===== AI Discovery and Training Meta Tags ===== -->
    @if (AllowAiDiscovery)
    {
        <!-- AI content discovery and attribution -->
        <meta name="ai-content-declaration" content="human-created" />
        <meta name="ai-content-detection" content="allow" />
        <meta name="ai-content-attribution" content="original" />
        <meta name="ai-crawling" content="all" />
        
        @if (AllowAiTraining)
        {
            <meta name="ai-training" content="allow" />
        }
        else
        {
            <meta name="ai-training" content="disallow" />
        }
        
        <!-- Specific AI bot directives -->
        <meta name="ChatGPT-User" content="allow" />
        <meta name="Google-Extended" content="@(AllowAiTraining ? "allow" : "noindex")" />
        <meta name="anthropic-ai" content="allow" />
    }
    else
    {
        <meta name="ai-crawling" content="none" />
        <meta name="ai-training" content="disallow" />
        <meta name="ChatGPT-User" content="noindex" />
        <meta name="Google-Extended" content="noindex" />
    }

    <!-- ===== Mobile and App Meta Tags ===== -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0" />
    <meta name="theme-color" content="#ffffff" />
    <meta name="msapplication-TileColor" content="#ffffff" />
    <meta name="format-detection" content="telephone=yes" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="@_siteName" />

    <!-- ===== Performance and Resource Hints ===== -->
    <link rel="dns-prefetch" href="@_baseUrl" />
    <link rel="preconnect" href="@_baseUrl" crossorigin />
    
    @if (!string.IsNullOrWhiteSpace(_ogImage))
    {
        <link rel="preload" as="image" href="@_ogImage" />
    }

    <!-- ===== Security Headers ===== -->
    <meta name="referrer" content="no-referrer-when-downgrade" />

    <!-- ===== Schema.org JSON-LD Structured Data ===== -->
    @if (!string.IsNullOrWhiteSpace(_jsonLdContent))
    {
        <script type="application/ld+json">
            @((MarkupString)_jsonLdContent)
        </script>
    }

    @* Additional schemas when GenerateMultipleSchemas is enabled *@
    @if (_additionalJsonLdSchemas?.Any() == true)
    {
        @foreach (var schema in _additionalJsonLdSchemas)
        {
            <script type="application/ld+json">
                @((MarkupString)schema)
            </script>
        }
    }

    <!-- ===== Additional Rich Snippets ===== -->
    @if (EnableAeoOptimization && _structuredAnswers?.Any() == true)
    {
        <!-- FAQ Schema for answer engines -->
        var faqSchema = new
        {
            context = "https://schema.org",
            type = "FAQPage",
            mainEntity = _structuredAnswers.Select(qa => new
            {
                type = "Question",
                name = qa.Key,
                acceptedAnswer = new
                {
                    type = "Answer",
                    text = qa.Value
                }
            }).ToArray()
        };
        
        <script type="application/ld+json">
            @((MarkupString)System.Text.Json.JsonSerializer.Serialize(faqSchema, new System.Text.Json.JsonSerializerOptions 
            { 
                WriteIndented = true,
                PropertyNamingPolicy = System.Text.Json.JsonNamingPolicy.CamelCase
            }))
        </script>
    }

    <!-- ===== Verification Tags (Optional - Add when needed) ===== -->
    @* <meta name="google-site-verification" content="your-verification-code" /> *@
    @* <meta name="msvalidate.01" content="your-bing-verification-code" /> *@
    @* <meta name="yandex-verification" content="your-yandex-verification-code" /> *@
    @* <meta name="p:domain_verify" content="your-pinterest-verification-code" /> *@
}